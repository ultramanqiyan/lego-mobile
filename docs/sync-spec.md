# ç½‘é¡µç«¯åŠŸèƒ½åŒæ­¥åˆ°ç§»åŠ¨ç«¯è§„æ ¼è¯´æ˜

## 1. é¡¹ç›®èƒŒæ™¯

å°†ç½‘é¡µç«¯æ–°å¢çš„åŠŸèƒ½å’Œé¡µé¢åŒæ­¥åˆ°React Nativeç§»åŠ¨ç«¯ï¼ˆlego-mobileï¼‰ï¼Œä¿æŒä¸¤ç«¯åŠŸèƒ½ä¸€è‡´æ€§ã€‚

---

## 2. ç½‘é¡µç«¯æ–°å¢åŠŸèƒ½åˆ†æ

### 2.1 æ•…äº‹å¯¼æ¼”å° (story-director.html) - **å…¨æ–°åŠŸèƒ½**

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- å¡ç‰Œæ‰‡å½¢å¸ƒå±€å±•ç¤ºè§’è‰²ã€å†’é™©ç±»å‹ã€åœ°å½¢ã€å¤©æ°”ã€é“å…·
- èˆå°é¢„è§ˆåŒºåŸŸï¼Œå®æ—¶æ˜¾ç¤ºé€‰æ‹©çš„è§’è‰²ç»„åˆ
- å¤©æ°”ç‰¹æ•ˆç³»ç»Ÿï¼ˆä¸‹é›¨ã€ä¸‹é›ªã€é›·ç”µã€é˜³å…‰ã€å½©è™¹ã€æ˜Ÿç©ºç­‰ï¼‰
- ç« èŠ‚ç”ŸæˆAPIè°ƒç”¨

**APIè°ƒç”¨ï¼š**
```
POST /api/chapters-generate?bookId={bookId}
Body: { userId, plotSelection, characterIds }
```

### 2.2 ä¸»é¢˜ç®¡ç†ç³»ç»Ÿ

**æ”¯æŒä¸»é¢˜ï¼š**
| ä¸»é¢˜ID | åç§° | ç‰¹ç‚¹ |
|--------|------|------|
| default | ç»å…¸ä¹é«˜ | é»˜è®¤ä¹é«˜è‰²å½© |
| immersive | æ²‰æµ¸æ•…äº‹ | æ·±è‰²èƒŒæ™¯ã€æ²‰æµ¸é˜…è¯» |
| gamified | æ¸¸æˆå†’é™© | æ¸¸æˆåŒ–UIå…ƒç´  |

### 2.3 ç« èŠ‚é˜…è¯»å¢å¼º

**æ–°å¢åŠŸèƒ½ï¼š**
- æ•…äº‹åˆ›ä½œæç¤ºè¯å±•ç¤ºé¢æ¿
- æƒ…èŠ‚é€‰æ‹©æ¨¡æ€æ¡†ï¼ˆå¤©æ°”ã€å†’é™©ç±»å‹ã€åœ°å½¢ã€è£…å¤‡ï¼‰
- ç« èŠ‚å¯¼èˆªå’Œåˆ†é¡µç³»ç»Ÿ
- å…³é”®è¯é«˜äº®ï¼ˆè§’è‰²åã€åŠ¨ä½œã€æƒ…æ„Ÿã€åœ°ç‚¹ï¼‰

### 2.4 å®¶é•¿æ§åˆ¶é¡µé¢ (parent.html) - **å…¨æ–°é¡µé¢**

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- æ¯æ—¥é˜…è¯»æ—¶é—´é™åˆ¶è®¾ç½®
- é˜…è¯»è®°å½•æŸ¥çœ‹
- æ—¶é—´ä½¿ç”¨ç»Ÿè®¡

**APIè°ƒç”¨ï¼š**
```
GET /api/users?userId={userId}
PUT /api/users { userId, dailyTimeLimit, timeUsed }
```

### 2.5 è°œé¢˜ç³»ç»Ÿå¢å¼º

**åŠŸèƒ½ï¼š**
- ç­”é¢˜äº¤äº’ä¼˜åŒ–
- å°è¯•æ¬¡æ•°é™åˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- æç¤ºåŠŸèƒ½
- æ­£ç¡®/é”™è¯¯åé¦ˆåŠ¨ç”»

---

## 3. ç§»åŠ¨ç«¯åŒæ­¥è®¡åˆ’

### 3.1 æ–°å¢é¡µé¢

| é¡µé¢ | æ–‡ä»¶è·¯å¾„ | ä¼˜å…ˆçº§ |
|------|----------|--------|
| æ•…äº‹å¯¼æ¼”å° | src/screens/story/StoryDirectorScreen.js | é«˜ |
| å®¶é•¿æ§åˆ¶ | src/screens/settings/ParentControlScreen.js | ä¸­ |

### 3.2 ä¿®æ”¹é¡µé¢

| é¡µé¢ | ä¿®æ”¹å†…å®¹ | ä¼˜å…ˆçº§ |
|------|----------|--------|
| ChapterScreen | æ·»åŠ æç¤ºè¯é¢æ¿ã€æƒ…èŠ‚é€‰æ‹©å™¨ã€å…³é”®è¯é«˜äº® | é«˜ |
| SettingsScreen | æ·»åŠ ä¸»é¢˜åˆ‡æ¢å…¥å£ | é«˜ |
| BookDetailScreen | æ·»åŠ å¯¼æ¼”å°å…¥å£ | ä¸­ |

### 3.3 æ–°å¢ç»„ä»¶

| ç»„ä»¶ | æ–‡ä»¶è·¯å¾„ | ç”¨é€” |
|------|----------|------|
| StoryDirector | src/components/story/StoryDirector.js | æ•…äº‹å¯¼æ¼”å°æ ¸å¿ƒç»„ä»¶ |
| CardDeck | src/components/story/CardDeck.js | å¡ç‰Œæ‰‡å½¢å¸ƒå±€ |
| StagePreview | src/components/story/StagePreview.js | èˆå°é¢„è§ˆåŒºåŸŸ |
| WeatherEffect | src/components/story/WeatherEffect.js | å¤©æ°”ç‰¹æ•ˆ |
| PlotSelector | src/components/story/PlotSelector.js | æƒ…èŠ‚é€‰æ‹©å™¨ |
| KeywordHighlight | src/components/chapter/KeywordHighlight.js | å…³é”®è¯é«˜äº®æ–‡æœ¬ |
| ThemeSelector | src/components/settings/ThemeSelector.js | ä¸»é¢˜é€‰æ‹©å™¨ |
| TimeLimitSetting | src/components/settings/TimeLimitSetting.js | æ—¶é—´é™åˆ¶è®¾ç½® |

### 3.4 æ–°å¢API

```javascript
// src/api/chapters.js - å·²æœ‰ï¼Œéœ€æ›´æ–°
async generateChapter(bookId, userId, plotSelection, characterIds) {
  return apiClient.post(`/chapters-generate?bookId=${bookId}`, {
    userId,
    plotSelection,
    characterIds
  });
}

// src/api/users.js - å·²æœ‰ï¼Œéœ€æ›´æ–°
async updateTimeLimit(userId, dailyTimeLimit) {
  return apiClient.put('/users', { userId, dailyTimeLimit });
}
```

---

## 4. è¯¦ç»†å®ç°è§„æ ¼

### 4.1 æ•…äº‹å¯¼æ¼”å° (StoryDirectorScreen)

**é¡µé¢å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Header: æ•…äº‹å¯¼æ¼”å°        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚      â”‚    èˆå°é¢„è§ˆåŒºåŸŸ       â”‚    â”‚
â”‚      â”‚  (è§’è‰²ç«™ä½ + å¤©æ°”ç‰¹æ•ˆ) â”‚    â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€‰æ‹©è§’è‰² (æ¨ªå‘æ»šåŠ¨å¡ç‰Œ)          â”‚
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”       â”‚
â”‚  â”‚ ğŸ‘¤â”‚ â”‚ ğŸ‘¤â”‚ â”‚ ğŸ‘¤â”‚ â”‚ ğŸ‘¤â”‚       â”‚
â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€‰æ‹©å¤©æ°”                        â”‚
â”‚  â˜€ï¸ ğŸŒ§ï¸ â›ˆï¸ â„ï¸ ğŸŒˆ ğŸŒ™             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€‰æ‹©å†’é™©ç±»å‹                    â”‚
â”‚  ğŸ—ºï¸ ğŸ¤ ğŸ’ª ğŸ” ğŸ’ ğŸ†             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€‰æ‹©åœ°å½¢                        â”‚
â”‚  ğŸŒ² ğŸ° ğŸŒŠ ğŸœï¸ â›°ï¸ ğŸŒ‹             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€‰æ‹©è£…å¤‡                        â”‚
â”‚  ğŸª„ ğŸ›¡ï¸ ğŸ—ºï¸ ğŸ”­ âš”ï¸ ğŸ§ª             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     [ğŸ¬ å¼€å§‹æ‹æ‘„ï¼] æŒ‰é’®         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€ç®¡ç†ï¼š**
```javascript
const [selectedCharacters, setSelectedCharacters] = useState([]);
const [plotSelection, setPlotSelection] = useState({
  weather: null,
  adventureType: null,
  terrain: null,
  equipment: null
});
const [isGenerating, setIsGenerating] = useState(false);
```

### 4.2 å¤©æ°”ç‰¹æ•ˆç³»ç»Ÿ

**æ”¯æŒçš„ç‰¹æ•ˆï¼š**
| å¤©æ°” | æ•ˆæœæè¿° |
|------|----------|
| sunny | é˜³å…‰å°„çº¿åŠ¨ç”» |
| rainy | é›¨æ»´ä¸‹è½åŠ¨ç”» |
| thunder | é—ªç”µé—ªçƒæ•ˆæœ |
| snow | é›ªèŠ±é£˜è½åŠ¨ç”» |
| fog | é›¾æ°”é®ç½©æ•ˆæœ |
| wind | é£å¹ç²’å­æ•ˆæœ |
| rainbow | å½©è™¹æ¸å˜æ•ˆæœ |
| starry | æ˜Ÿç©ºé—ªçƒæ•ˆæœ |

**å®ç°æ–¹å¼ï¼š**
- ä½¿ç”¨React Native Animated API
- ç²’å­ç³»ç»Ÿä½¿ç”¨å¤šä¸ªAnimated.View

### 4.3 å…³é”®è¯é«˜äº®

**é«˜äº®ç±»å‹ï¼š**
| ç±»å‹ | é¢œè‰² | ç¤ºä¾‹ |
|------|------|------|
| è§’è‰²å | æ ¹æ®è§’è‰²ç±»å‹ | ä¸»è§’(æ©™è‰²)ã€é…è§’(è“è‰²) |
| åŠ¨ä½œè¯ | ç»¿è‰² | é£å‘ã€è·³è·ƒã€å¥”è·‘ |
| æƒ…æ„Ÿè¯ | ç´«è‰² | å¼€å¿ƒã€å‹‡æ•¢ã€å®³æ€• |
| åœ°ç‚¹è¯ | é’è‰² | åŸå ¡ã€æ£®æ—ã€å¤ªç©º |

**å®ç°æ–¹å¼ï¼š**
```javascript
function highlightKeywords(content, characters) {
  // è§£ææ–‡æœ¬ï¼Œæ›¿æ¢å…³é”®è¯ä¸ºé«˜äº®ç»„ä»¶
  // è¿”å›Textç»„ä»¶æ•°ç»„
}
```

### 4.4 ä¸»é¢˜ç³»ç»Ÿ

**ä¸»é¢˜é…ç½®ï¼š**
```javascript
const themes = {
  default: {
    colors: {
      primary: '#FFD500',
      background: '#FFF8E7',
      text: '#333333',
    }
  },
  immersive: {
    colors: {
      primary: '#1A1A2E',
      background: '#0F0F1A',
      text: '#FFFFFF',
    }
  },
  gamified: {
    colors: {
      primary: '#9C27B0',
      background: '#2D2D44',
      text: '#FFFFFF',
    }
  }
};
```

### 4.5 å®¶é•¿æ§åˆ¶é¡µé¢

**é¡µé¢å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å®¶é•¿æ§åˆ¶                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  ğŸ“Š ä»Šæ—¥é˜…è¯»æ—¶é—´                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 45/120åˆ†é’Ÿ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                 â”‚
â”‚  â° æ¯æ—¥æ—¶é—´é™åˆ¶                 â”‚
â”‚  [-] 120 [+] åˆ†é’Ÿ               â”‚
â”‚                                 â”‚
â”‚  ğŸ“… æœ¬å‘¨é˜…è¯»è®°å½•                 â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”‚
â”‚  â”‚ä¸€ â”‚äºŒ â”‚ä¸‰ â”‚å›› â”‚äº” â”‚å…­ â”‚æ—¥ â”‚ â”‚
â”‚  â”‚30 â”‚45 â”‚60 â”‚30 â”‚45 â”‚90 â”‚0  â”‚ â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚  ğŸ“š é˜…è¯»ç»Ÿè®¡                     â”‚
â”‚  â€¢ å®Œæˆæ•…äº‹: 5ä¸ª                 â”‚
â”‚  â€¢ å®Œæˆç« èŠ‚: 23ç«                 â”‚
â”‚  â€¢ è§£ç­”è°œé¢˜: 18é“                â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ä»»åŠ¡åˆ—è¡¨

### Phase 1: æ ¸å¿ƒåŠŸèƒ½åŒæ­¥ (é«˜ä¼˜å…ˆçº§)
- [ ] åˆ›å»ºStoryDirectorScreené¡µé¢
- [ ] åˆ›å»ºCardDeckå¡ç‰Œç»„ä»¶
- [ ] åˆ›å»ºStagePreviewèˆå°é¢„è§ˆç»„ä»¶
- [ ] åˆ›å»ºWeatherEffectå¤©æ°”ç‰¹æ•ˆç»„ä»¶
- [ ] æ›´æ–°ChapterScreenæ·»åŠ æç¤ºè¯é¢æ¿
- [ ] åˆ›å»ºKeywordHighlightå…³é”®è¯é«˜äº®ç»„ä»¶
- [ ] æ›´æ–°PlotSelectoræƒ…èŠ‚é€‰æ‹©å™¨

### Phase 2: ä¸»é¢˜ç³»ç»Ÿ (é«˜ä¼˜å…ˆçº§)
- [ ] æ›´æ–°ThemeContextæ”¯æŒä¸‰ç§ä¸»é¢˜
- [ ] åˆ›å»ºThemeSelectorç»„ä»¶
- [ ] æ›´æ–°SettingsScreenæ·»åŠ ä¸»é¢˜å…¥å£
- [ ] æ›´æ–°æ‰€æœ‰é¡µé¢æ”¯æŒä¸»é¢˜åˆ‡æ¢

### Phase 3: å®¶é•¿æ§åˆ¶ (ä¸­ä¼˜å…ˆçº§)
- [ ] åˆ›å»ºParentControlScreené¡µé¢
- [ ] åˆ›å»ºTimeLimitSettingç»„ä»¶
- [ ] æ›´æ–°ç”¨æˆ·APIæ”¯æŒæ—¶é—´é™åˆ¶
- [ ] æ›´æ–°AdventureScreenæ˜¾ç¤ºæ—¶é—´é™åˆ¶

### Phase 4: UIä¼˜åŒ– (ä½ä¼˜å…ˆçº§)
- [ ] æ·»åŠ å¡ç‰ŒåŠ¨ç”»æ•ˆæœ
- [ ] æ·»åŠ é¡µé¢è¿‡æ¸¡åŠ¨ç”»
- [ ] ä¼˜åŒ–åŠ è½½çŠ¶æ€æ˜¾ç¤º

---

## 6. éªŒæ”¶æ ‡å‡†

### 6.1 åŠŸèƒ½éªŒæ”¶
- æ•…äº‹å¯¼æ¼”å°å¯ä»¥æ­£å¸¸é€‰æ‹©è§’è‰²ã€å¤©æ°”ã€åœ°å½¢ç­‰
- å¤©æ°”ç‰¹æ•ˆæ­£ç¡®æ˜¾ç¤º
- ç« èŠ‚é˜…è¯»é¡µé¢æ˜¾ç¤ºæç¤ºè¯å’Œé«˜äº®å…³é”®è¯
- ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½æ­£å¸¸
- å®¶é•¿æ§åˆ¶é¡µé¢å¯ä»¥è®¾ç½®æ—¶é—´é™åˆ¶

### 6.2 UIéªŒæ”¶
- ç§»åŠ¨ç«¯UIä¸ç½‘é¡µç«¯é£æ ¼ä¸€è‡´
- åŠ¨ç”»æ•ˆæœæµç•…
- å“åº”å¼å¸ƒå±€é€‚é…ä¸åŒå±å¹•å°ºå¯¸

### 6.3 APIéªŒæ”¶
- æ‰€æœ‰APIè°ƒç”¨æ­£å¸¸
- é”™è¯¯å¤„ç†æ­£ç¡®
- æ•°æ®æŒä¹…åŒ–æ­£å¸¸
